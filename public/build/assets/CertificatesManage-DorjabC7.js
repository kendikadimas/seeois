import{r as A,X as F,u as v,c as a,o as l,b as M,j as B,a as s,f,i as c,t as o,w as L,e as h,n as g,d as m,F as w,y,C as x}from"./app-CR2mpfjv.js";import{S as $}from"./StaffLayout-BXjUpHW-.js";import{s as k}from"./index-B1mkpeUi.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ModalConfirmation-aFADB0PC.js";const P={class:"container-fluid mt-4 mb-4"},V={key:0,class:"alert alert-success alert-dismissible fade show",role:"alert"},O={key:1,class:"alert alert-danger alert-dismissible fade show",role:"alert"},j={class:"row"},E={class:"col-lg-4 mb-4"},R={class:"card border-0 shadow-sm"},T={class:"card-body"},z={class:"mb-3"},G=["value"],H={key:0,class:"invalid-feedback"},I={class:"mb-3"},X={key:0,class:"invalid-feedback"},q={class:"mb-3"},J={key:0,class:"invalid-feedback"},K=["disabled"],Q={key:0,class:"bi bi-cloud-upload"},W={key:1,class:"spinner-border spinner-border-sm me-2",role:"status"},Y={class:"col-lg-8"},Z={class:"card border-0 shadow-sm"},ss={class:"card-header bg-light"},ts={class:"mb-0"},es={class:"table-responsive"},is={class:"table table-hover mb-0"},as={key:0},ls={class:"d-flex align-items-center gap-2"},os={class:"text-dark fw-500"},ns={class:"text-dark"},rs={class:"text-muted"},ds={class:"badge bg-light text-dark"},us={class:"text-center"},cs=["onClick"],bs=["onClick"],fs={__name:"CertificatesManage",props:{applications:Array,certs:Array},setup(p){const b=A(!1),n=F({}),u=v({internship_application_id:"",generated_for_user_id:"",file:null}),_=i=>i?new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}):"-",C=async()=>{b.value=!0,n.value={},u.post(k("certificate.store"),{onSuccess:()=>{u.reset(),b.value=!1},onError:i=>{n.value=i,b.value=!1}})},S=async i=>{try{const t=await fetch(k("certificate.download",i));if(!t.ok)throw new Error("Failed to download");const e=await t.blob(),r=window.URL.createObjectURL(e),d=document.createElement("a");d.href=r,d.download=`sertifikat-${i}.pdf`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(r),document.body.removeChild(d)}catch(t){console.error("Download error:",t),alert("Gagal mengunduh sertifikat")}},U=i=>{if(!confirm("Apakah Anda yakin ingin menghapus sertifikat ini?"))return;v({}).delete(k("certificate.destroy",i))};return(i,t)=>(l(),a("div",P,[M($,null,{default:B(()=>[t[22]||(t[22]=s("div",{class:"row mb-4"},[s("div",{class:"col-12"},[s("h1",{class:"h3 fw-bold text-dark"},[s("i",{class:"bi bi-file-pdf"}),c(" Manajemen Sertifikat Magang ")]),s("p",{class:"text-muted"},"Unggah, edit, dan kelola sertifikat magang dari sini.")])],-1)),i.$page.props.flash.success?(l(),a("div",V,[t[3]||(t[3]=s("i",{class:"bi bi-check-circle"},null,-1)),c(" "+o(i.$page.props.flash.success)+" ",1),t[4]||(t[4]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert"},null,-1))])):f("",!0),i.$page.props.flash.error?(l(),a("div",O,[t[5]||(t[5]=s("i",{class:"bi bi-exclamation-circle"},null,-1)),c(" "+o(i.$page.props.flash.error)+" ",1),t[6]||(t[6]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert"},null,-1))])):f("",!0),s("div",j,[s("div",E,[s("div",R,[t[14]||(t[14]=s("div",{class:"card-header bg-primary text-white"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-cloud-upload"}),c(" Unggah Sertifikat Baru ")])],-1)),s("div",T,[s("form",{onSubmit:L(C,["prevent"]),enctype:"multipart/form-data"},[s("div",z,[t[8]||(t[8]=s("label",{class:"form-label fw-bold"},"Pilih Aplikasi Magang",-1)),h(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>m(u).internship_application_id=e),class:g(["form-select",{"is-invalid":n.internship_application_id}])},[t[7]||(t[7]=s("option",{value:""},"-- Pilih Aplikasi --",-1)),(l(!0),a(w,null,y(p.applications,e=>{var r;return l(),a("option",{key:e.id,value:e.id},o((r=e.user)==null?void 0:r.name)+" - "+o(_(e.created_at)),9,G)}),128))],2),[[x,m(u).internship_application_id]]),n.internship_application_id?(l(),a("div",H,o(n.internship_application_id[0]),1)):f("",!0)]),s("div",I,[t[10]||(t[10]=s("label",{class:"form-label fw-bold"},"Untuk Pengguna (Opsional)",-1)),h(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>m(u).generated_for_user_id=e),class:g(["form-select",{"is-invalid":n.generated_for_user_id}])},[...t[9]||(t[9]=[s("option",{value:""},"-- Otomatis dari Aplikasi --",-1)])],2),[[x,m(u).generated_for_user_id]]),t[11]||(t[11]=s("small",{class:"text-muted"},"Biarkan kosong untuk menggunakan pengguna dari aplikasi",-1)),n.generated_for_user_id?(l(),a("div",X,o(n.generated_for_user_id[0]),1)):f("",!0)]),s("div",q,[t[12]||(t[12]=s("label",{class:"form-label fw-bold"},"File Sertifikat (PDF)",-1)),s("input",{type:"file",class:g(["form-control",{"is-invalid":n.file}]),onChange:t[2]||(t[2]=e=>m(u).file=e.target.files[0]),accept:".pdf"},null,34),t[13]||(t[13]=s("small",{class:"text-muted"},"Maksimal 20MB, format PDF",-1)),n.file?(l(),a("div",J,o(n.file[0]),1)):f("",!0)]),s("button",{type:"submit",disabled:b.value,class:"btn btn-primary w-100"},[b.value?(l(),a("span",W)):(l(),a("i",Q)),c(" "+o(b.value?"Mengunggah...":"Unggah Sertifikat"),1)],8,K)],32)])])]),s("div",Y,[s("div",Z,[s("div",ss,[s("h5",ts,[t[15]||(t[15]=s("i",{class:"bi bi-list"},null,-1)),c(" Daftar Sertifikat ("+o(p.certs.length)+") ",1)])]),s("div",es,[s("table",is,[t[21]||(t[21]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{class:"fw-bold"},"Penerima"),s("th",{class:"fw-bold"},"Tanggal Terbit"),s("th",{class:"fw-bold"},"Diterbitkan Oleh"),s("th",{class:"fw-bold"},"Unduhan"),s("th",{class:"fw-bold text-center"},"Aksi")])],-1)),s("tbody",null,[p.certs.length===0?(l(),a("tr",as,[...t[16]||(t[16]=[s("td",{colspan:"5",class:"text-center text-muted py-4"}," Belum ada sertifikat yang diunggah ",-1)])])):f("",!0),(l(!0),a(w,null,y(p.certs,e=>{var r,d;return l(),a("tr",{key:e.id,class:"align-middle"},[s("td",null,[s("div",ls,[t[17]||(t[17]=s("i",{class:"bi bi-person text-info"},null,-1)),s("span",os,o(((r=e.recipient)==null?void 0:r.name)||"N/A"),1)])]),s("td",null,[s("span",ns,o(_(e.issued_at)),1)]),s("td",null,[s("span",rs,o(((d=e.issuer)==null?void 0:d.name)||"N/A"),1)]),s("td",null,[s("span",ds,[t[18]||(t[18]=s("i",{class:"bi bi-download"},null,-1)),c(" "+o(e.download_count||0),1)])]),s("td",us,[s("button",{onClick:D=>S(e.id),class:"btn btn-sm btn-info me-2",title:"Unduh"},[...t[19]||(t[19]=[s("i",{class:"bi bi-download"},null,-1)])],8,cs),s("button",{onClick:D=>U(e.id),class:"btn btn-sm btn-danger",title:"Hapus"},[...t[20]||(t[20]=[s("i",{class:"bi bi-trash"},null,-1)])],8,bs)])])}),128))])])])])])])]),_:1})]))}},vs=N(fs,[["__scopeId","data-v-30d07228"]]);export{vs as default};
